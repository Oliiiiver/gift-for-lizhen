<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>给李祯的奇迹应援 ✨</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Noto+Serif+SC:wght@500&display=swap" rel="stylesheet">
    <style>
        /* --- 核心修正：全局盒模型 --- */
        /* 这行代码保证 padding 不会把盒子撑大，是解决溢出的关键 */
        * { box-sizing: border-box; } 

        :root {
            --primary-green: #5D8C62;
            --soft-white: #FDFBF7;
            --accent-orange: #FF8C42; 
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow-x: hidden; font-family: 'ZCOOL KuaiLe', cursive;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- 启动页 --- */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #89C4F4; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 1s; cursor: pointer;
        }
        #start-overlay h1 { 
            color: white; font-size: 3em; 
            animation: bounce 2s infinite; 
            text-shadow: 0 4px 10px rgba(0,0,0,0.1); 
            text-align: center; padding: 0 20px;
        }
        .start-hint { margin-top: 20px; color: white; font-size: 1.5em; background: rgba(255,255,255,0.3); padding: 10px 30px; border-radius: 30px; }

        /* --- 背景层 --- */
        #scenery-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; overflow: hidden;
            background-color: #A6CBE4; 
        }
        .bg-layer {
            position: absolute; left: 0; width: 100%;
            background-size: cover; background-repeat: no-repeat;
            will-change: transform; 
        }
        .layer-base-sky {
            top: 0; height: 100%;
            background-image: url('https://i.pinimg.com/1200x/a2/41/86/a24186ae8768fa8d572305aa91d2fdf5.jpg');
            background-position: center center; z-index: 1;
            animation: deepBreath 60s ease-in-out infinite alternate;
        }
        .layer-mid-grass {
            bottom: 0; height: 70%;
            background-image: url('https://i.pinimg.com/1200x/97/84/3c/97843c60ae9060f5841850dd74c9e02b.jpg');
            background-position: center bottom; z-index: 2;
            animation: subtleSway 80s ease-in-out infinite alternate;
            transform-origin: bottom center;
        }
        .layer-fore-flowers {
            bottom: 0; height: 45%;
            background-image: url('https://i.pinimg.com/1200x/a6/bc/bd/a6bcbd52c911ddb2291f6cf1abfd05e8.jpg');
            background-position: center bottom; z-index: 3;
            animation: grassWave 20s ease-in-out infinite alternate;
            transform-origin: bottom center;
            filter: brightness(1.05);
        }
        .god-rays {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(110deg, transparent 0%, rgba(255,255,255,0.15) 3%, transparent 7%, rgba(255,255,255,0.05) 10%);
            z-index: 4; pointer-events: none; mix-blend-mode: overlay;
            animation: rayShift 40s linear infinite; opacity: 0.8;
        }
        .texture-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.08'/%3E%3C/svg%3E");
            pointer-events: none; mix-blend-mode: multiply; z-index: 10; opacity: 0.3;
        }

        @keyframes deepBreath { from { transform: scale(1); } to { transform: scale(1.03); } }
        @keyframes subtleSway { from { transform: translateX(-1%) scale(1.02); } to { transform: translateX(1%) scale(1.02); } }
        @keyframes grassWave { from { transform: skewX(-1deg) scale(1.05); } to { transform: skewX(1deg) scale(1.05); } }
        @keyframes rayShift { from { background-position: 0% 0%; } to { background-position: 50% 50%; } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* --- 笔记本 --- */
        .main-notebook {
            max-width: 700px; 
            width: 90%;       
            margin: 60px auto; 
            background: var(--soft-white); 
            border-radius: 10px;
            position: relative; z-index: 20; 
            box-shadow: 0 5px 30px rgba(0,0,0,0.2), 0 0 0 5px rgba(255,255,255,0.4);
            padding: 40px; 
            min-height: 80vh;
            background-image: repeating-linear-gradient(#FDFBF7 0px, #FDFBF7 29px, #E1E8EE 30px);
            transition: all 0.3s ease;
        }
        .main-notebook::after { content: ''; position: absolute; left: 15px; top: 20px; bottom: 20px; width: 10px; border-left: 3px dotted #bbb; }
        h1.page-title { text-align: center; color: #556B2F; font-size: 2.2em; margin-bottom: 40px; text-shadow: 2px 2px 0 #fff; }

        /* --- 模块通用 (修正溢出问题) --- */
        .section-card {
            background: white; border: 2px solid #E0E0E0; border-radius: 15px;
            padding: 25px; margin-bottom: 30px; position: relative;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.05); transition: transform 0.2s;
            margin-left: 20px;
            /* 关键点 1：让白框成为绝对边界 */
            width: auto; 
            max-width: 100%;
            overflow: hidden; /* 任何超出的东西都会被切掉 */
        }
        .section-icon { position: absolute; right: 10px; top: -15px; font-size: 2.5em; background: white; padding: 0 5px; border-radius: 50%; }
        
        #daily-quote { font-size: 1.2em; color: #444; text-align: center; min-height: 50px; line-height: 1.6; }
        .btn-flower { background: #FF9AA2; color: white; border: none; padding: 8px 25px; border-radius: 20px; display: block; margin: 15px auto 0; cursor: pointer; font-family: inherit; font-size: 1em; }

        /* --- 功能2：卡西法 (修正溢出问题) --- */
        .calcifer-box { 
            display: flex; gap: 8px; margin-top: 15px; 
            width: 100%; /* 占满白框内部宽度 */
            max-width: 100%; /* 不允许超出 */
        }
        .calcifer-btn { background: var(--accent-orange); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; white-space: nowrap; font-family: inherit;}
        #anxiety-input { 
            flex: 1; /* 自动占据剩余空间 */
            padding: 10px; 
            border: 2px solid #ddd; 
            border-radius: 8px; 
            outline: none; 
            font-family: inherit;
            /* 关键点 2：输入框彻底限制 */
            width: 100%; 
            min-width: 0; /* 防止 flex 子项无法收缩 */
            max-width: 100%; 
        }

        /* --- 答题 --- */
        .quiz-container { position: relative; min-height: 250px; margin-top: 20px; max-width: 100%; }
        .quiz-step { display: none; animation: slideIn 0.4s ease; width: 100%; }
        .quiz-step.active { display: block; }
        .quiz-question-text { font-size: 1.2em; font-weight: bold; color: #2E7D32; display: block; margin-bottom: 15px; line-height: 1.4; word-wrap: break-word;}
        .quiz-option-btn { background: #F1F8E9; border: 1px solid #C5E1A5; padding: 12px; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: 0.2s; font-size: 1em; word-break: break-all; width: 100%; }
        .quiz-option-btn.selected { background: #AED581; color: white; border-color: #7CB342; }
        .input-line { border: none; border-bottom: 2px dashed #888; background: transparent; width: 100%; font-size: 1.1em; outline: none; padding: 5px 0; border-radius: 0; max-width: 100%; }
        .quiz-controls { display: flex; align-items: center; margin-top: 20px; gap: 15px; flex-wrap: wrap; }
        .progress-bar { flex: 1; height: 10px; background: #eee; border-radius: 5px; overflow: hidden; min-width: 50px;}
        .progress-fill { height: 100%; background: #66BB6A; width: 0%; transition: width 0.3s; }
        .btn-next { background: #26A69A; color: white; border: none; padding: 10px 25px; border-radius: 20px; cursor: pointer; font-family: inherit; font-size: 1em; white-space: nowrap; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }

        /* --- 检查清单 --- */
        .checklist-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 1.1em; }
        .checklist-grid label { display: flex; align-items: center; gap: 5px; cursor: pointer; }
        .checklist-grid input { transform: scale(1.2); flex-shrink: 0; }

        /* --- 弹窗 --- */
        .modal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); z-index: 2000; 
            justify-content: center; align-items: center; 
            padding: 20px;
        }
        
        /* --- 功能5：刮刮乐 (修正溢出问题) --- */
        .scratch-wrapper { 
            border: 4px solid #8D6E63; 
            border-radius: 10px; 
            /* 关键点 3：宽度改为百分比，用 max-width 限制最大值 */
            width: 100%; 
            max-width: 280px; 
            margin: 0 auto; 
            position: relative; 
            overflow: hidden; 
            touch-action: none; 
            /* 保持宽高比 2:1，防止压扁 */
            aspect-ratio: 2 / 1;
        }
        /* 强制 Canvas 随 wrapper 缩放 */
        #scratch-canvas {
            width: 100% !important;
            height: 100% !important;
            display: block;
        }

        .music-control { position: fixed; bottom: 20px; right: 20px; width: 45px; height: 45px; background: white; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 1000; font-size: 20px; }
        .soot { position: absolute; width: 12px; height: 12px; background: #333; border-radius: 50%; pointer-events: none; z-index: 9999; }

        /* =========================================
           📱 移动端适配 (最终修复)
           ========================================= */
        @media screen and (max-width: 768px) {
            #start-overlay h1 { font-size: 2em; }
            .start-hint { font-size: 1.1em; padding: 8px 20px; }
            
            .main-notebook {
                margin: 20px auto; 
                width: 92%; 
                padding: 25px 15px; /* 笔记本内边距 15px */
                min-height: 85vh;
            }
            .main-notebook::after { left: 5px; border-left: 1px dotted #bbb; }
            
            h1.page-title { font-size: 1.8em; margin-bottom: 25px; }
            
            .section-card { 
                margin-left: 0; 
                padding: 15px; /* 白框内边距 15px */
                width: 100%; /* 确保白框不超笔记本 */
            }
            .section-icon { font-size: 2em; top: -20px; right: 5px; }

            /* 文本框强制换行，宽度占满 */
            .calcifer-box { flex-direction: column; }
            .calcifer-btn { width: 100%; margin-top: 5px; }
            #anxiety-input { width: 100%; max-width: 100%; }

            .checklist-grid { grid-template-columns: 1fr; font-size: 1.05em; }
            .checklist-grid label { padding: 5px 0; border-bottom: 1px dashed #eee; }

            /* 刮刮乐在手机上也强制 100% 宽（但不超过280） */
            .scratch-wrapper { 
                width: 100%; 
                max-width: 280px; 
            }

            .modal > div { width: 100% !important; padding: 25px 15px !important; max-height: 85vh; overflow-y: auto; }
            .layer-mid-grass { height: 50%; background-position: center bottom; }
            .layer-fore-flowers { height: 35%; background-position: center bottom; }
        }
    </style>
</head>
<body>

    <div id="start-overlay" onclick="enterWorld()">
        <h1>🍃 祯祯的备考世界</h1>
        <div class="start-hint">👉 点击进入魔法庭院 👈</div>
        <p style="color:white; margin-top:10px; font-size: 0.9em; opacity: 0.8;">(记得打开声音哦)</p>
    </div>

    <audio id="bgm" loop>
        <source src="https://commondatastorage.googleapis.com/codeskulptor-assets/Epoq-Lepidoptera.ogg" type="audio/ogg"> 
    </audio>

    <div id="scenery-container">
        <div class="bg-layer layer-base-sky"></div>
        <div class="bg-layer layer-mid-grass"></div>
        <div class="bg-layer layer-fore-flowers"></div>
        <div class="god-rays"></div>
        <div class="texture-overlay"></div>
    </div>

    <div class="main-notebook">
        <h1 class="page-title">✨ 考前能量补给站 ✨</h1>

        <div class="section-card">
            <div class="section-icon">☀️</div>
            <h3>今日份元气</h3>
            <div id="daily-quote">加载中...</div>
            <button class="btn-flower" onclick="updateQuote()">🌸 换一句</button>
        </div>

        <div class="section-card">
            <div class="section-icon">🔥</div>
            <h3>卡西法的焦虑火炉</h3>
            <p style="color:#666; font-size:0.9em;">把你此刻的担忧写下来，卡西法会帮你吃掉！</p>
            <div class="calcifer-box">
                <input type="text" id="anxiety-input" placeholder="例如：背书背得想吐...">
                <button class="calcifer-btn" onclick="burnAnxiety()">🔥 烧掉它！</button>
            </div>
        </div>

        <div class="section-card">
            <div class="section-icon">📝</div>
            <h3>考前最后一套“真题”</h3>
            <div class="quiz-container" id="quiz-box"></div>
            <div class="quiz-controls">
                <div class="progress-bar"><div class="progress-fill" id="prog-fill"></div></div>
                <button class="btn-next" onclick="nextQuestion()">下一题 ➡️</button>
            </div>
        </div>

        <div class="section-card">
            <div class="section-icon">🎒</div>
            <h3>出发前检查</h3>
            <div class="checklist-grid">
                <label><input type="checkbox"> 🆔 身份证</label>
                <label><input type="checkbox"> 🎫 准考证</label>
                <label><input type="checkbox"> 👜 文具袋</label>
                <label><input type="checkbox"> 🖊️ 黑笔 x3</label>
                <label><input type="checkbox"> ✏️ 2B铅笔</label>
                <label><input type="checkbox"> 🧽 橡皮</label>
                <label><input type="checkbox"> 🧘‍♀️ 平常心</label>
                <label><input type="checkbox"> ✨ 自信</label>
            </div>
        </div>

        <div class="section-card" style="text-align: center;">
            <h3>🎉 预支庆功券</h3>
            <div class="scratch-wrapper">
                <div style="position: absolute; width:100%; height:100%; top:0; left:0; display:flex; flex-direction:column; justify-content:center; align-items:center; background:#FFD54F; color:#5D4037; font-weight:bold;">
                    <span>🎂 迟到的生日礼物</span><span>+</span><span>🎁 神秘大礼！</span>
                </div>
                <canvas id="scratch-canvas" width="280" height="140" style="position: relative; z-index: 2; cursor: pointer;"></canvas>
            </div>
        </div>
    </div>

    <div class="modal" id="result-modal">
        <div style="background: radial-gradient(circle at center, #2b32b2 0%, #141e30 100%); border-radius: 15px; box-shadow: 0 0 30px rgba(0,0,0,0.5); font-family: 'Georgia', 'Songti SC', 'SimSun', serif; color: #fff; max-width: 600px; width: 90%; margin: 0 auto; border: 1px solid #4ca1af;">
            <div style="background: #fffaf0; color: #2c3e50; padding: 30px; border-radius: 8px; position: relative; box-shadow: 0 10px 25px rgba(0,0,0,0.3); border: 2px solid #d4af37; outline: 4px double #d4af37; outline-offset: -10px;">
                <div style="text-align: center; margin-bottom: 20px; color: #d4af37; font-size: 1.5em;">✦ ☾ ✦</div>
                <h3 style="color: #8e44ad; margin-top: 0; font-size: 1.3em; border-bottom: 1px dashed #d4af37; padding-bottom: 10px; display: inline-block;">亲爱的李祯：</h3>
                <p style="line-height: 1.8; font-size: 1.05em; margin-top: 20px;">恭喜你完成了考试前的最后一套真题！我相信你已经做好了充足的准备，去面对考场上可能出现的一切艰难险阻。</p>
                <p style="line-height: 1.8; font-size: 1.05em;">我想引用你曾经写给我的话，作为考前的最后激励：</p>
                <div style="background: #fdf6e3; border-left: 4px solid #d4af37; padding: 15px 20px; margin: 20px 0; border-radius: 0 10px 10px 0; font-style: italic; color: #5d4037; position: relative;">
                    <span style="font-size: 2em; line-height: 0.5; position: absolute; top: 10px; left: 5px; color: #d4af37; opacity: 0.5;">“</span>我想我终于在这一刻接受了命运安排的一切，接受所有不完满和不甘心。归零之后是新的一局，但我已熟知这游戏的规则。<span style="font-size: 2em; line-height: 0.5; position: absolute; bottom: -5px; right: 10px; color: #d4af37; opacity: 0.5;">”</span>
                </div>
                <p style="line-height: 1.8; font-size: 1.05em;">在这句话里，我再次见证了你的坚毅与决心。</p>
                <p style="line-height: 1.8; font-size: 1.05em;">我希望，当你看到这段话的时候，可以抛下一路以来的焦虑与担忧，去拥抱这两年来沉甸甸的成长。你一定不会辜负自己的努力，我永远支持你~</p>
                <div style="text-align: center; margin-top: 30px; font-weight: bold; color: #c0392b; letter-spacing: 2px; font-size: 1.2em;">加油加油加油！！！ ❤️</div>
            </div>
            <button onclick="document.getElementById('result-modal').style.display='none'" style="width:100%; padding:15px; background:#4ca1af; color:white; border:none; border-radius:30px; margin-top:20px; cursor:pointer; font-size:1.1em; font-weight:bold; box-shadow: 0 5px 15px rgba(76, 161, 175, 0.4);">💌 收下这份祝福</button>
        </div>
    </div>

    <div class="music-control" onclick="toggleMusic()">🎵</div>

    <script>
        // --- 核心逻辑 ---
        const bgm = document.getElementById('bgm');
        function enterWorld() {
            const overlay = document.getElementById('start-overlay');
            overlay.style.opacity = '0';
            setTimeout(() => overlay.remove(), 1000);
            bgm.volume = 0.5;
            const playPromise = bgm.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => { console.log("等待交互播放"); });
            }
        }
        function toggleMusic() { bgm.paused ? bgm.play() : bgm.pause(); }

        // 1. 每日激励
        const quotes = [
            "今天不想学？没关系，爱因斯坦也有想摆烂的时候。",
            "你的大脑正在疯狂扩容，发热是CPU升级的正常现象！",
            "考研就像洗衣服，中间搅得很乱，洗完就干净清爽了。",
            "你不是在背书，你是在往脑子里存金条！",
            "乾坤未定，你我皆是黑马！",
            "想想考完那天，火锅奶茶在向你疯狂招手！",
            "起风了，唯有努力生存！——《起风了》",
            "不管前方的路有多苦，只要走的方向正确，都比站在原地更接近幸福。——《千与千寻》"
        ];
        function updateQuote() { document.getElementById('daily-quote').innerText = quotes[Math.floor(Math.random()*quotes.length)]; }
        updateQuote();

        // 2. 焦虑火炉
        function burnAnxiety() {
            const input = document.getElementById('anxiety-input');
            const btn = document.querySelector('.calcifer-btn');
            if(!input.value) return;
            confetti({ particleCount: 60, spread: 50, origin: { y: 0.7 }, colors: ['#FF4500', '#FFA500'] });
            input.style.transition = "0.5s"; input.style.transform = "scale(0)"; btn.innerText = "🔥 吞噬中...";
            setTimeout(() => { input.value = ""; input.style.transform = "scale(1)"; input.placeholder = "嗝~ 味道不错！还有吗？"; btn.innerText = "🔥 烧掉它！"; }, 1000);
        }

        // 3. 题目逻辑
        const qs = [
            { t: "s", q: "1. 谁会在考研中取得最理想的成绩？", o: ["李祯", "祯祯", "小祯", "以上都是"] },
            { t: "s", q: "2. 当考试中遇到不会做或耗时很久的题目时，正确的应对方案是：", o: ["遇到困难睡大觉", "我要和它死磕到底！！！", "当场撕试卷，震惊全考场","此时不蒙更待何时，先做下一题"] },
            { t: "s", q: "3. 名词解释题或政治大题想不起来原话，应该：", o: ["空着", "用自己的话，结合关键词，把卷子写满！", "画个海绵宝宝", "写满马克思的名字"] },
            { t: "s", q: "4. 下列哪项是考试必备？", o: ["知识", "技巧", "相信自己配得上研究生的自信", "以上都是"] },
            { t: "s", q: "5. 正确面对考研的心态是？", o: ["我已经做好了充足的准备，这次一定美美拿下！", "我难人亦难，我把题做完", "严肃以待的同时保持平常心", "以上都是"] },
            { t: "s", q: "6. 英语作文如果不确定单词拼写怎么办？", o: ["生搬硬套，相信记忆力", "换同义词或近义词", "写拼音，与批卷老师对暗号", "写中文"] },
            { t: "i", q: "7. 请输入一句你想对自己说的狠话或鼓励的话：", ph: "老娘最棒..." },
            { t: "s", q: "8. 考试期间饮食方面应该注意什么呢？", o: ["化身恶食王，火锅奶茶一顿塞", "夏天清凉组：西瓜杨梅冻梨", "清淡、温热、七分饱的食物", "想吃什么吃什么"] },
            { t: "i", q: "9. 考完试想做的第一件事是什么？", ph: "睡三天..." },
            { t: "i", q: "10. 请在横线上签下你的名字，领取“好运Buff”：", ph: "签名处" },
            { t: "s", q: "11. 你准备好去迎接你的未来了吗？", o: ["准备好了！", "时刻准备着！", "冲啊！", "我一定可以！！！"] }
        ];
        let curIdx = 0; const qBox = document.getElementById('quiz-box'); const pFill = document.getElementById('prog-fill'); const nBtn = document.querySelector('.btn-next');
        function renderQ() {
            qBox.innerHTML = "";
            qs.forEach((item, i) => {
                const d = document.createElement('div'); d.className = `quiz-step ${i===0?'active':''}`;
                let h = `<span class="quiz-question-text">${item.q}</span>`;
                if(item.t === 's') { item.o.forEach(opt => h += `<div class="quiz-option-btn" onclick="sel(this)">${opt}</div>`); } else { h += `<input class="input-line" placeholder="${item.ph}">`; }
                d.innerHTML = h; qBox.appendChild(d);
            });
        }
        function sel(el) { Array.from(el.parentElement.children).forEach(c=>c.classList.remove('selected')); el.classList.add('selected'); }
        function nextQuestion() {
            const steps = document.querySelectorAll('.quiz-step');
            if(curIdx === qs.length - 1) { confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } }); document.getElementById('result-modal').style.display = 'flex'; return; }
            steps[curIdx].classList.remove('active'); curIdx++; steps[curIdx].classList.add('active');
            pFill.style.width = `${(curIdx / (qs.length-1))*100}%`;
            if(curIdx === qs.length - 1) { nBtn.innerText = "✨ 提交试卷 ✨"; nBtn.style.background = "#FF8C42"; }
        }
        renderQ();

        // 4. 刮刮乐 (带缩放自适应计算)
        const cvs = document.getElementById('scratch-canvas'); 
        const ctx = cvs.getContext('2d'); 
        let draw = false;
        
        ctx.fillStyle = '#C0C0C0'; 
        ctx.fillRect(0,0,280,140); 
        ctx.fillStyle = '#666'; 
        ctx.font='20px Arial'; 
        ctx.fillText("✨ 刮开惊喜 ✨", 80, 80);
        
        function scratch(e) { 
            if(!draw) return; 
            e.preventDefault(); 
            
            const r = cvs.getBoundingClientRect(); 
            const clientX = e.clientX || e.touches[0].clientX;
            const clientY = e.clientY || e.touches[0].clientY;
            
            const x = clientX - r.left; 
            const y = clientY - r.top; 
            
            // 关键：计算Canvas的CSS显示大小和实际像素大小的比例
            const scaleX = cvs.width / r.width;
            const scaleY = cvs.height / r.height;

            ctx.globalCompositeOperation = 'destination-out'; 
            ctx.beginPath(); 
            // 将鼠标坐标乘以缩放比例，映射回Canvas内部坐标
            ctx.arc(x * scaleX, y * scaleY, 15, 0, Math.PI*2); 
            ctx.fill(); 
        }
        
        cvs.addEventListener('mousedown',()=>draw=true); cvs.addEventListener('mouseup',()=>draw=false); cvs.addEventListener('mousemove',scratch); 
        cvs.addEventListener('touchstart',(e)=>{draw=true;scratch(e)}, {passive: false}); 
        cvs.addEventListener('touchmove',scratch, {passive: false}); 
        cvs.addEventListener('touchend',()=>draw=false);

        // 5. 鼠标/手指 小煤球
        document.addEventListener('mousemove', createSoot);
        document.addEventListener('click', (e) => { createSoot(e); createSoot(e); });

        function createSoot(e) {
            if(Math.random()>0.9) { 
                const s = document.createElement('div'); s.className='soot'; 
                const px = e.pageX || (e.changedTouches ? e.changedTouches[0].pageX : 0);
                const py = e.pageY || (e.changedTouches ? e.changedTouches[0].pageY : 0);
                if (!px && !py) return; 
                s.style.left = px + 'px'; 
                s.style.top = py + 'px'; 
                document.body.appendChild(s); 
                s.animate([{opacity:0.8, transform:'scale(0)'}, {opacity:0, transform:'translateY(-30px) scale(1.5)'}], {duration:800, fill:'forwards'}); 
                setTimeout(()=>s.remove(), 800); 
            } 
        }

    </script>
</body>
</html>
